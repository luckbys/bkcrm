// ğŸ§ª TESTE DIRETO WEBSOCKET - Simular mensagem do servidor para frontend\n\nconsole.log('ğŸš€ TESTE WEBSOCKET DIRETO INICIADO!');\n\nasync function testarConexaoWebSocket() {\n    console.log('\\nğŸ”Œ 1. TESTANDO CONEXÃƒO WEBSOCKET...');\n    \n    // Verificar se o frontend estÃ¡ conectado\n    if (typeof window !== 'undefined' && window.useChatStore) {\n        const store = window.useChatStore.getState();\n        \n        console.log('ğŸ“Š Estado atual do chat store:', {\n            isConnected: store.isConnected,\n            socket: store.socket ? 'exists' : 'null',\n            totalTickets: Object.keys(store.messages).length,\n            tickets: Object.keys(store.messages)\n        });\n        \n        if (!store.isConnected || !store.socket) {\n            console.log('âŒ Frontend nÃ£o conectado ao WebSocket');\n            console.log('ğŸ”„ Tentando conectar...');\n            store.init();\n            \n            // Aguardar conexÃ£o\n            await new Promise(resolve => {\n                const checkConnection = setInterval(() => {\n                    const currentState = window.useChatStore.getState();\n                    if (currentState.isConnected) {\n                        clearInterval(checkConnection);\n                        resolve(true);\n                    }\n                }, 500);\n                \n                // Timeout apÃ³s 10 segundos\n                setTimeout(() => {\n                    clearInterval(checkConnection);\n                    resolve(false);\n                }, 10000);\n            });\n        }\n        \n        const finalState = window.useChatStore.getState();\n        console.log('âœ… Estado final:', {\n            isConnected: finalState.isConnected,\n            socketId: finalState.socket?.id\n        });\n        \n        return finalState.isConnected;\n    } else {\n        console.log('âŒ useChatStore nÃ£o encontrado no window');\n        return false;\n    }\n}\n\nasync function simularMensagemDoServidor() {\n    console.log('\\nğŸ“¨ 2. SIMULANDO MENSAGEM DO SERVIDOR...');\n    \n    const ticketId = '788a5f10-a693-4cfa-8410-ed5cd082e555';\n    \n    // Verificar se store estÃ¡ disponÃ­vel\n    if (typeof window === 'undefined' || !window.useChatStore) {\n        console.log('âŒ Store nÃ£o disponÃ­vel');\n        return false;\n    }\n    \n    const store = window.useChatStore.getState();\n    \n    if (!store.socket || !store.isConnected) {\n        console.log('âŒ Socket nÃ£o conectado');\n        return false;\n    }\n    \n    // 1. Primeiro, vamos entrar no ticket\n    console.log(`ğŸ”— Entrando no ticket ${ticketId}...`);\n    store.join(ticketId);\n    \n    // Aguardar um pouco\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    // 2. Simular mensagem do servidor (formato igual ao servidor real)\n    const novaMensagem = {\n        id: `test-frontend-${Date.now()}`,\n        ticket_id: ticketId,\n        content: `ğŸ¯ TESTE FRONTEND DIRETO - ${new Date().toLocaleTimeString()} - Esta mensagem deve aparecer!`,\n        sender_id: null, // Cliente\n        sender_name: 'Cliente Teste Frontend',\n        is_internal: false,\n        created_at: new Date().toISOString(),\n        type: 'text'\n    };\n    \n    console.log('ğŸ“¨ Enviando mensagem simulada:', novaMensagem);\n    \n    // Simular evento 'new-message' vindo do servidor\n    if (store.socket) {\n        // MÃ©todo 1: Emitir evento diretamente no socket (simular servidor)\n        store.socket.emit('new-message', novaMensagem);\n        \n        // MÃ©todo 2: Disparar listener manualmente\n        const event = new CustomEvent('websocket-new-message', {\n            detail: novaMensagem\n        });\n        window.dispatchEvent(event);\n        \n        console.log('âœ… Mensagem simulada enviada');\n        \n        // Verificar se mensagem apareceu no estado\n        await new Promise(resolve => setTimeout(resolve, 500));\n        \n        const updatedState = window.useChatStore.getState();\n        const ticketMessages = updatedState.messages[ticketId] || [];\n        \n        console.log('ğŸ“Š Mensagens no ticket apÃ³s simulaÃ§Ã£o:', {\n            total: ticketMessages.length,\n            ultima: ticketMessages[ticketMessages.length - 1]?.content?.substring(0, 50)\n        });\n        \n        return ticketMessages.length > 0;\n    }\n    \n    return false;\n}\n\nasync function verificarEventListeners() {\n    console.log('\\nğŸ§ 3. VERIFICANDO EVENT LISTENERS...');\n    \n    if (typeof window === 'undefined' || !window.useChatStore) {\n        console.log('âŒ Store nÃ£o disponÃ­vel');\n        return;\n    }\n    \n    const store = window.useChatStore.getState();\n    \n    if (!store.socket) {\n        console.log('âŒ Socket nÃ£o disponÃ­vel');\n        return;\n    }\n    \n    // Verificar listeners do socket\n    const socket = store.socket;\n    const events = ['new-message', 'messages-loaded', 'joined-ticket', 'error'];\n    \n    console.log('ğŸ“‹ Event listeners registrados:');\n    events.forEach(event => {\n        const listenerCount = socket.listenerCount(event);\n        console.log(`  ${event}: ${listenerCount} listeners`);\n        \n        if (listenerCount === 0) {\n            console.warn(`âš ï¸ Nenhum listener para evento '${event}'`);\n        }\n    });\n    \n    // Verificar eventos personalizados no window\n    console.log('\\nğŸŒ Eventos window disponÃ­veis:');\n    const windowEvents = [\n        'chat-message-received',\n        'websocket-new-message'\n    ];\n    \n    windowEvents.forEach(event => {\n        console.log(`  ${event}: disponÃ­vel`);\n    });\n}\n\nasync function testeCompleto() {\n    console.log('ğŸ¯ === TESTE COMPLETO WEBSOCKET + FRONTEND ===\\n');\n    \n    try {\n        // 1. Testar conexÃ£o\n        const conectado = await testarConexaoWebSocket();\n        if (!conectado) {\n            console.log('âŒ Falha na conexÃ£o, abortando teste');\n            return;\n        }\n        \n        // 2. Verificar listeners\n        await verificarEventListeners();\n        \n        // 3. Simular mensagem\n        const mensagemRecebida = await simularMensagemDoServidor();\n        \n        // 4. Resultado final\n        console.log('\\nğŸ RESULTADO FINAL:');\n        console.log(`ConexÃ£o: ${conectado ? 'âœ…' : 'âŒ'}`);\n        console.log(`Mensagem recebida: ${mensagemRecebida ? 'âœ…' : 'âŒ'}`);\n        \n        if (conectado && mensagemRecebida) {\n            console.log('ğŸ‰ TESTE PASSOU! Frontend estÃ¡ recebendo mensagens.');\n        } else {\n            console.log('ğŸ’¥ TESTE FALHOU! Verificar problemas na conexÃ£o ou listeners.');\n        }\n        \n    } catch (error) {\n        console.error('âŒ Erro no teste:', error);\n    }\n}\n\n// Disponibilizar funÃ§Ãµes globalmente\nwindow.testarConexaoWebSocket = testarConexaoWebSocket;\nwindow.simularMensagemDoServidor = simularMensagemDoServidor;\nwindow.verificarEventListeners = verificarEventListeners;\nwindow.testeCompleto = testeCompleto;\n\nconsole.log('âœ… FUNÃ‡Ã•ES DISPONÃVEIS:');\nconsole.log('ğŸ“ testarConexaoWebSocket() - Testar conexÃ£o');\nconsole.log('ğŸ“¨ simularMensagemDoServidor() - Simular mensagem');\nconsole.log('ğŸ§ verificarEventListeners() - Verificar listeners');\nconsole.log('ğŸ¯ testeCompleto() - Executar teste completo');\nconsole.log('\\nğŸ’¡ Execute: testeCompleto()'); 